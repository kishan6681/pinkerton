/*
Deployment script for USR_DEV_4

This code was generated by a tool.
Changes to this file may cause incorrect behavior and will be lost if
the code is regenerated.
*/

GO
SET ANSI_NULLS, ANSI_PADDING, ANSI_WARNINGS, ARITHABORT, CONCAT_NULL_YIELDS_NULL, QUOTED_IDENTIFIER ON;

SET NUMERIC_ROUNDABORT OFF;


GO
:setvar DatabaseName "USR_DEV_4"
:setvar DefaultFilePrefix "USR_DEV_4"
:setvar DefaultDataPath "C:\Users\mkomaravolu\AppData\Local\Microsoft\VisualStudio\SSDT\USR_DEV"
:setvar DefaultLogPath "C:\Users\mkomaravolu\AppData\Local\Microsoft\VisualStudio\SSDT\USR_DEV"

GO
:on error exit
GO
/*
Detect SQLCMD mode and disable script execution if SQLCMD mode is not supported.
To re-enable the script after enabling SQLCMD mode, execute the following:
SET NOEXEC OFF; 
*/
:setvar __IsSqlCmdEnabled "True"
GO
IF N'$(__IsSqlCmdEnabled)' NOT LIKE N'True'
    BEGIN
        PRINT N'SQLCMD mode must be enabled to successfully execute this script.';
        SET NOEXEC ON;
    END


GO
USE [$(DatabaseName)];


GO
IF EXISTS (SELECT 1
           FROM   [master].[dbo].[sysdatabases]
           WHERE  [name] = N'$(DatabaseName)')
    BEGIN
        ALTER DATABASE [$(DatabaseName)]
            SET ARITHABORT ON,
                CONCAT_NULL_YIELDS_NULL ON,
                CURSOR_DEFAULT LOCAL 
            WITH ROLLBACK IMMEDIATE;
    END


GO
IF EXISTS (SELECT 1
           FROM   [master].[dbo].[sysdatabases]
           WHERE  [name] = N'$(DatabaseName)')
    BEGIN
        ALTER DATABASE [$(DatabaseName)]
            SET PAGE_VERIFY NONE,
                DISABLE_BROKER 
            WITH ROLLBACK IMMEDIATE;
    END


GO
ALTER DATABASE [$(DatabaseName)]
    SET TARGET_RECOVERY_TIME = 0 SECONDS 
    WITH ROLLBACK IMMEDIATE;


GO
IF EXISTS (SELECT 1
           FROM   [master].[dbo].[sysdatabases]
           WHERE  [name] = N'$(DatabaseName)')
    BEGIN
        ALTER DATABASE [$(DatabaseName)]
            SET QUERY_STORE (CLEANUP_POLICY = (STALE_QUERY_THRESHOLD_DAYS = 367)) 
            WITH ROLLBACK IMMEDIATE;
    END


GO
PRINT N'Creating [EA]...';


GO
CREATE SCHEMA [EA]
    AUTHORIZATION [dbo];


GO
PRINT N'Creating [EA].[L_SUB_SERVICES]...';


GO
CREATE TABLE [EA].[L_SUB_SERVICES] (
    [SUB_SERVICES_ID]   INT           IDENTITY (1, 1) NOT NULL,
    [SERVICES_ID]       INT           NULL,
    [SUB_SERVICES_NAME] VARCHAR (MAX) NULL,
    [IS_DELETED]        BIT           NULL,
    [CREATE_DATE]       DATETIME      NULL,
    [CREATE_LOGIN_ID]   VARCHAR (255) NULL,
    [UPDATE_DATE]       DATETIME      NULL,
    [UPDATE_LOGIN_ID]   VARCHAR (255) NULL,
    CONSTRAINT [PK_L_SUB_SERVICES] PRIMARY KEY CLUSTERED ([SUB_SERVICES_ID] ASC)
);


GO
PRINT N'Creating [EA].[L_SERVICES]...';


GO
CREATE TABLE [EA].[L_SERVICES] (
    [SERVICES_ID]     INT           IDENTITY (1, 1) NOT NULL,
    [SERVICES_NAME]   VARCHAR (255) NULL,
    [IS_DELETED]      BIT           NULL,
    [CREATE_DATE]     DATETIME      NULL,
    [CREATE_LOGIN_ID] VARCHAR (255) NULL,
    [UPDATE_DATE]     DATETIME      NULL,
    [UPDATE_LOGIN_ID] VARCHAR (255) NULL,
    CONSTRAINT [PK_L_SERVICES] PRIMARY KEY CLUSTERED ([SERVICES_ID] ASC)
);


GO
PRINT N'Creating [EA].[L_SERVICE_TYPE_CATEGORY]...';


GO
CREATE TABLE [EA].[L_SERVICE_TYPE_CATEGORY] (
    [SERVICE_TYPE_CATEGORY_ID]   INT           IDENTITY (1, 1) NOT NULL,
    [SERVICE_TYPE_ID]            INT           NULL,
    [SERVICE_TYPE_CATEGORY_NAME] VARCHAR (255) NULL,
    [IS_DELETED]                 BIT           NULL,
    [CREATE_DATE]                DATETIME      NULL,
    [CREATE_LOGIN_ID]            VARCHAR (255) NULL,
    [UPDATE_DATE]                DATETIME      NULL,
    [UPDATE_LOGIN_ID]            VARCHAR (255) NULL,
    CONSTRAINT [PK_L_SERVICE_TYPE_CATEGORY] PRIMARY KEY CLUSTERED ([SERVICE_TYPE_CATEGORY_ID] ASC)
);


GO
PRINT N'Creating [EA].[L_SERVICE_TYPE]...';


GO
CREATE TABLE [EA].[L_SERVICE_TYPE] (
    [SERVICE_TYPE_ID]   INT           IDENTITY (1, 1) NOT NULL,
    [SERVICE_TYPE_NAME] VARCHAR (MAX) NULL,
    [IS_DELETED]        BIT           NULL,
    [CREATE_DATE]       DATETIME      NULL,
    [CREATE_LOGIN_ID]   VARCHAR (255) NULL,
    [UPDATE_DATE]       DATETIME      NULL,
    [UPDATE_LOGIN_ID]   VARCHAR (255) NULL,
    CONSTRAINT [PK_L_SERVICE_TYPE] PRIMARY KEY CLUSTERED ([SERVICE_TYPE_ID] ASC)
);


GO
PRINT N'Creating [EA].[L_REQUESTING_REGION]...';


GO
CREATE TABLE [EA].[L_REQUESTING_REGION] (
    [REQUESTING_REGION_ID]   INT           IDENTITY (1, 1) NOT NULL,
    [REQUESTING_REGION_NAME] VARCHAR (255) NULL,
    [IS_DELETED]             BIT           NULL,
    [CREATE_DATE]            DATETIME      NULL,
    [CREATE_LOGIN_ID]        VARCHAR (255) NULL,
    [UPDATE_DATE]            DATETIME      NULL,
    [UPDATE_LOGIN_ID]        VARCHAR (255) NULL,
    CONSTRAINT [PK_L_REQUESTING_REGION] PRIMARY KEY CLUSTERED ([REQUESTING_REGION_ID] ASC)
);


GO
PRINT N'Creating [EA].[L_REQUESTING_OFFICE]...';


GO
CREATE TABLE [EA].[L_REQUESTING_OFFICE] (
    [REQUESTING_OFFICE_ID]   INT           IDENTITY (1, 1) NOT NULL,
    [REGION_ID]              INT           NOT NULL,
    [REQUESTING_OFFICE_NAME] VARCHAR (255) NULL,
    [IS_DELETED]             BIT           NULL,
    [CREATE_DATE]            DATETIME      NULL,
    [CREATE_LOGIN_ID]        VARCHAR (255) NULL,
    [UPDATE_DATE]            DATETIME      NULL,
    [UPDATE_LOGIN_ID]        VARCHAR (255) NULL,
    CONSTRAINT [PK_L_REQUESTING_OFFICE] PRIMARY KEY CLUSTERED ([REQUESTING_OFFICE_ID] ASC)
);


GO
PRINT N'Creating [EA].[L_REQUESTING_DIRECTOR_DEPARTMENT]...';


GO
CREATE TABLE [EA].[L_REQUESTING_DIRECTOR_DEPARTMENT] (
    [REQUESTING_DIRECTOR_DEPARTMENT_ID] INT           IDENTITY (1, 1) NOT NULL,
    [REQUESTING_DIRECTOR_ID]            VARCHAR (255) NULL,
    [DEPARTMENT_NAME]                   VARCHAR (255) NULL,
    [IS_DELETED]                        BIT           NULL,
    [CREATE_DATE]                       DATETIME      NULL,
    [CREATE_LOGIN_ID]                   VARCHAR (255) NULL,
    [UPDATE_DATE]                       DATETIME      NULL,
    [UPDATE_LOGIN_ID]                   VARCHAR (255) NULL,
    CONSTRAINT [PK_REQUESTING_DIRECTOR_DEPARTMENT] PRIMARY KEY CLUSTERED ([REQUESTING_DIRECTOR_DEPARTMENT_ID] ASC)
);


GO
PRINT N'Creating [EA].[L_MASTER_VALUE]...';


GO
CREATE TABLE [EA].[L_MASTER_VALUE] (
    [MASTER_VALUE_ID] INT           IDENTITY (1, 1) NOT NULL,
    [MASTER_TYPE_ID]  INT           NULL,
    [REF_CODE]        VARCHAR (255) NULL,
    [DESCRIPTION]     VARCHAR (MAX) NULL,
    [IS_DELETED]      BIT           NULL,
    [CREATE_DATE]     DATETIME      NULL,
    [CREATE_LOGIN_ID] VARCHAR (255) NULL,
    [UPDATE_DATE]     DATETIME      NULL,
    [UPDATE_USER_ID]  VARCHAR (255) NULL,
    CONSTRAINT [PK_L_MASTER_VALUE] PRIMARY KEY CLUSTERED ([MASTER_VALUE_ID] ASC)
);


GO
PRINT N'Creating [EA].[L_MASTER_TYPE]...';


GO
CREATE TABLE [EA].[L_MASTER_TYPE] (
    [MASTER_TYPE_ID]  INT           IDENTITY (1, 1) NOT NULL,
    [REF_CODE]        VARCHAR (255) NULL,
    [DESCRIPTION]     VARCHAR (255) NULL,
    [IS_DELETED]      BIT           NULL,
    [CREATE_DATE]     DATETIME      NULL,
    [CREATE_LOGIN_ID] VARCHAR (255) NULL,
    [UPDATE_DATE]     DATETIME      NULL,
    [UPDATE_USER_ID]  VARCHAR (255) NULL,
    CONSTRAINT [PK_L_MASTER_TYPE] PRIMARY KEY CLUSTERED ([MASTER_TYPE_ID] ASC)
);


GO
PRINT N'Creating [EA].[L_GROUP]...';


GO
CREATE TABLE [EA].[L_GROUP] (
    [GROUP_ID]        INT           IDENTITY (1, 1) NOT NULL,
    [GROUP_NAME]      VARCHAR (255) NULL,
    [IS_DELETED]      BIT           NULL,
    [CREATE_DATE]     DATETIME      NULL,
    [CREATE_LOGIN_ID] VARCHAR (255) NULL,
    [UPDATE_DATE]     DATETIME      NULL,
    [UPDATE_LOGIN_ID] VARCHAR (255) NULL,
    CONSTRAINT [PK_L_GROUP] PRIMARY KEY CLUSTERED ([GROUP_ID] ASC)
);


GO
PRINT N'Creating [EA].[L_COUNTRY]...';


GO
CREATE TABLE [EA].[L_COUNTRY] (
    [COUNTRY_ID]      INT           IDENTITY (1, 1) NOT NULL,
    [COUNTRY_NAME]    VARCHAR (255) NULL,
    [IS_DELETED]      BIT           NULL,
    [CREATE_DATE]     DATETIME      NULL,
    [CREATE_LOGIN_ID] VARCHAR (255) NULL,
    [UPDATE_DATE]     DATETIME      NULL,
    [UPDATE_LOGIN_ID] VARCHAR (255) NULL,
    CONSTRAINT [PK_L_COUNTRY] PRIMARY KEY CLUSTERED ([COUNTRY_ID] ASC)
);


GO
PRINT N'Creating [EA].[L_CLIENT_REQUESTING_OFFICE]...';


GO
CREATE TABLE [EA].[L_CLIENT_REQUESTING_OFFICE] (
    [CLIENT_REQUESTING_OFFICE_ID] INT           IDENTITY (1, 1) NOT NULL,
    [CLIENT_ID]                   INT           NOT NULL,
    [REQUESTING_OFFICE_ID]        INT           NULL,
    [IS_DELETED]                  BIT           NULL,
    [CREATE_DATE]                 DATETIME      NULL,
    [CREATE_LOGIN_ID]             VARCHAR (255) NULL,
    [UPDATE_DATE]                 DATETIME      NULL,
    [UPDATE_LOGIN_ID]             VARCHAR (255) NULL,
    CONSTRAINT [PK_L_CLIENT_REQUESTING_OFFICE] PRIMARY KEY CLUSTERED ([CLIENT_REQUESTING_OFFICE_ID] ASC)
);


GO
PRINT N'Creating [EA].[L_CLIENT]...';


GO
CREATE TABLE [EA].[L_CLIENT] (
    [CLIENT_ID]       INT           IDENTITY (1, 1) NOT NULL,
    [EMAIL_ID]        VARCHAR (255) NULL,
    [CLIENT_NAME]     VARCHAR (255) NULL,
    [CLIENT_CODE]     VARCHAR (255) NULL,
    [IS_DELETED]      BIT           NULL,
    [CREATE_DATE]     DATETIME      NULL,
    [CREATE_LOGIN_ID] VARCHAR (255) NULL,
    [UPDATE_DATE]     DATETIME      NULL,
    [UPDATE_LOGIN_ID] VARCHAR (255) NULL,
    CONSTRAINT [PK_L_CLIENT] PRIMARY KEY CLUSTERED ([CLIENT_ID] ASC)
);


GO
PRINT N'Creating [EA].[T_USR_SERVICE_TYPE]...';


GO
CREATE TABLE [EA].[T_USR_SERVICE_TYPE] (
    [USR_SERVICE_TYPE_ID] INT           IDENTITY (1, 1) NOT NULL,
    [USR_ID]              INT           NULL,
    [SERVICE_ID]          INT           NULL,
    [SUB_SERVICE_ID]      INT           NULL,
    [IS_DELETED]          BIT           NULL,
    [CREATE_DATE]         DATETIME      NULL,
    [CREATE_LOGIN_ID]     VARCHAR (255) NULL,
    [UPDATE_DATE]         DATETIME      NULL,
    [UPDATE_LOGIN_ID]     VARCHAR (255) NULL,
    CONSTRAINT [PK_T_USR_SERVICE_TYPE] PRIMARY KEY CLUSTERED ([USR_SERVICE_TYPE_ID] ASC)
);


GO
PRINT N'Creating [EA].[T_USR_RECIPIENTS]...';


GO
CREATE TABLE [EA].[T_USR_RECIPIENTS] (
    [USR_RECIPIENTS_ID] INT           IDENTITY (1, 1) NOT NULL,
    [USR_ID]            INT           NULL,
    [RECIPIENT_NAME]    VARCHAR (255) NULL,
    [IS_DELETED]        BIT           NULL,
    [CREATE_DATE]       DATETIME      NULL,
    [CREATE_LOGIN_ID]   VARCHAR (255) NULL,
    [UPDATE_DATE]       DATETIME      NULL,
    [UPDATE_LOGIN_ID]   VARCHAR (255) NULL,
    CONSTRAINT [PK_T_USR_RECIPIENTS] PRIMARY KEY CLUSTERED ([USR_RECIPIENTS_ID] ASC)
);


GO
PRINT N'Creating [EA].[T_USR_PURPOSE]...';


GO
CREATE TABLE [EA].[T_USR_PURPOSE] (
    [USR_PURPOSE_ID]   INT           IDENTITY (1, 1) NOT NULL,
    [USR_ID]           INT           NULL,
    [PURPOSE_REF_CODE] VARCHAR (255) NULL,
    [IS_DELETED]       BIT           NULL,
    [CREATE_DATE]      DATETIME      NULL,
    [CREATE_LOGIN_ID]  VARCHAR (255) NULL,
    [UPDATE_DATE]      DATETIME      NULL,
    [UPDATE_LOGIN_ID]  VARCHAR (255) NULL,
    CONSTRAINT [PK_T_USR_PURPOSE] PRIMARY KEY CLUSTERED ([USR_PURPOSE_ID] ASC)
);


GO
PRINT N'Creating [EA].[T_USR_LOCATION]...';


GO
CREATE TABLE [EA].[T_USR_LOCATION] (
    [USR_LOCATION_ID]      INT             IDENTITY (1, 1) NOT NULL,
    [USR_ID]               INT             NULL,
    [STREET_ADDRESS]       VARCHAR (MAX)   NULL,
    [CITY]                 VARCHAR (255)   NULL,
    [STATE]                VARCHAR (255)   NULL,
    [ZIP_CODE]             VARCHAR (255)   NULL,
    [COUNTRY_ID]           INT             NULL,
    [LATITUDE]             DECIMAL (18, 9) NULL,
    [LONGITUDE]            DECIMAL (18, 9) NULL,
    [RADIUS]               DECIMAL (18, 9) NULL,
    [LOCATION_DESCRIPTION] VARCHAR (MAX)   NULL,
    [IS_DELETED]           BIT             NULL,
    [CREATE_DATE]          DATETIME        NULL,
    [CREATE_LOGIN_ID]      VARCHAR (255)   NULL,
    [UPDATE_DATE]          DATETIME        NULL,
    [UPDATE_LOGIN_ID]      VARCHAR (255)   NULL,
    [IS_SUBJECT_LOCATION]  BIT             NULL,
    [SUBJECT_NAME]         VARCHAR (255)   NULL,
    [DATE_OF_BIRTH]        DATE            NULL,
    [GENDER]               VARCHAR (255)   NULL,
    [NATIONALITY]          VARCHAR (255)   NULL,
    [UNIT]                 VARCHAR (255)   NULL,
    CONSTRAINT [PK_T_USR_LOCATION] PRIMARY KEY CLUSTERED ([USR_LOCATION_ID] ASC)
);


GO
PRINT N'Creating [EA].[T_USR_AUTHOR]...';


GO
CREATE TABLE [EA].[T_USR_AUTHOR] (
    [USR_AUTHOR_ID]   INT           IDENTITY (1, 1) NOT NULL,
    [USR_ID]          INT           NULL,
    [AUTHOR_NAME]     VARCHAR (255) NULL,
    [START_DATE]      DATETIME      NULL,
    [END_DATE]        DATETIME      NULL,
    [DESCRIPTION]     VARCHAR (MAX) NULL,
    [IS_DELETED]      BIT           NULL,
    [CREATE_DATE]     DATETIME      NULL,
    [CREATE_LOGIN_ID] VARCHAR (255) NULL,
    [UPDATE_DATE]     DATETIME      NULL,
    [UPDATE_LOGIN_ID] VARCHAR (255) NULL,
    CONSTRAINT [PK_T_USR_AUTHOR] PRIMARY KEY CLUSTERED ([USR_AUTHOR_ID] ASC)
);


GO
PRINT N'Creating [EA].[T_USR_ATTACHMENTS]...';


GO
CREATE TABLE [EA].[T_USR_ATTACHMENTS] (
    [USR_ATTACHMENTS_ID] INT           IDENTITY (1, 1) NOT NULL,
    [USR_ID]             INT           NULL,
    [FILE_NAME]          VARCHAR (255) NULL,
    [FILE_PATH]          VARCHAR (MAX) NULL,
    [IS_DELETED]         BIT           NULL,
    [CREATE_DATE]        DATETIME      NULL,
    [CREATE_LOGIN_ID]    VARCHAR (255) NULL,
    [UPDATE_DATE]        DATETIME      NULL,
    [UPDATE_LOGIN_ID]    VARCHAR (255) NULL,
    CONSTRAINT [PK_T_USR_ATTACHMENTS] PRIMARY KEY CLUSTERED ([USR_ATTACHMENTS_ID] ASC)
);


GO
PRINT N'Creating [EA].[T_USR_ASSET_SOS_DETAILS]...';


GO
CREATE TABLE [EA].[T_USR_ASSET_SOS_DETAILS] (
    [USR_ASSET_SOS_DETAILS_ID] INT           IDENTITY (1, 1) NOT NULL,
    [USR_ASSET_ID]             INT           NULL,
    [EMAIL_ID]                 VARCHAR (255) NULL,
    [COUNTRY_CODE]             VARCHAR (255) NULL,
    [PHONE]                    VARCHAR (255) NULL,
    [IS_DELETED]               BIT           NULL,
    [CREATE_DATE]              DATETIME      NULL,
    [CREATE_LOGIN_ID]          VARCHAR (255) NULL,
    [UPDATE_DATE]              DATETIME      NULL,
    [UPDATE_LOGIN_ID]          VARCHAR (255) NULL,
    CONSTRAINT [PK_T_USR_ASSET_SOS_DETAILS] PRIMARY KEY CLUSTERED ([USR_ASSET_SOS_DETAILS_ID] ASC)
);


GO
PRINT N'Creating [EA].[T_USR_ASSET_NOTIFICATION]...';


GO
CREATE TABLE [EA].[T_USR_ASSET_NOTIFICATION] (
    [USR_ASSET_NOTIFICATION_ID] INT           IDENTITY (1, 1) NOT NULL,
    [USR_ASSET_ID]              INT           NULL,
    [NOTIFICATION]              VARCHAR (MAX) NULL,
    [IS_DELETED]                BIT           NULL,
    [CREATE_DATE]               DATETIME      NULL,
    [CREATE_LOGIN_ID]           VARCHAR (255) NULL,
    [UPDATE_DATE]               DATETIME      NULL,
    [UPDATE_LOGIN_ID]           VARCHAR (255) NULL,
    CONSTRAINT [PK_T_USR_ASSET_NOTIFICATION] PRIMARY KEY CLUSTERED ([USR_ASSET_NOTIFICATION_ID] ASC)
);


GO
PRINT N'Creating [EA].[T_USR_ASSET]...';


GO
CREATE TABLE [EA].[T_USR_ASSET] (
    [USR_ASSET_ID]       INT           IDENTITY (1, 1) NOT NULL,
    [USR_ID]             INT           NOT NULL,
    [ASSET_TYPE]         INT           NULL,
    [LOGIN_ID]           VARCHAR (255) NULL,
    [IMEI_WARNE]         VARCHAR (255) NULL,
    [NAME]               VARCHAR (255) NULL,
    [DISPLAY_NAME]       VARCHAR (255) NULL,
    [MOBILE_NUMBER]      VARCHAR (255) NULL,
    [DEVICE_INFO]        VARCHAR (255) NULL,
    [USER_TYPE_ID]       INT           NULL,
    [GROUP_ID]           INT           NULL,
    [TRACK_START_DATE]   DATETIME      NULL,
    [TRACK_END_DATE]     DATETIME      NULL,
    [CLIENT]             VARCHAR (255) NULL,
    [DEVICE_MODEL]       VARCHAR (255) NULL,
    [DEVICE_ID]          VARCHAR (255) NULL,
    [DEVICE_SERIAL]      VARCHAR (255) NULL,
    [COLOR]              VARCHAR (255) NULL,
    [TARCKING_FREQUENCY] VARCHAR (255) NULL,
    [LOW_BATTERY_ALERT]  VARCHAR (255) NULL,
    [ADDRESS]            VARCHAR (MAX) NULL,
    [IS_DELETED]         BIT           NULL,
    [CREATE_DATE]        DATETIME      NULL,
    [CREATE_LOGIN_ID]    VARCHAR (255) NULL,
    [UPDATE_DATE]        DATETIME      NULL,
    [UPDATE_LOGIN_ID]    VARCHAR (255) NULL,
    CONSTRAINT [PK_T_USR_ASSET] PRIMARY KEY CLUSTERED ([USR_ASSET_ID] ASC)
);


GO
PRINT N'Creating [EA].[T_USR_ALERT_WARNE_TYPE]...';


GO
CREATE TABLE [EA].[T_USR_ALERT_WARNE_TYPE] (
    [USR_ALERT_WARNE_TYPE_ID] INT           IDENTITY (1, 1) NOT NULL,
    [USR_ID]                  INT           NULL,
    [WARNE_TYPE_REF_CODE]     VARCHAR (255) NULL,
    [IS_DELETED]              BIT           NULL,
    [CREATE_DATE]             DATETIME      NULL,
    [CREATE_LOGIN_ID]         VARCHAR (255) NULL,
    [UPDATE_DATE]             DATETIME      NULL,
    [UPDATE_LOGIN_ID]         VARCHAR (255) NULL,
    CONSTRAINT [PK_T_USR_ALERT_WARNE_TYPE] PRIMARY KEY CLUSTERED ([USR_ALERT_WARNE_TYPE_ID] ASC)
);


GO
PRINT N'Creating [EA].[T_USR_ALERT_URGENCY]...';


GO
CREATE TABLE [EA].[T_USR_ALERT_URGENCY] (
    [USR_ALERT_URGENCY_ID] INT           IDENTITY (1, 1) NOT NULL,
    [USR_ID]               INT           NULL,
    [URGENCY_REF_CODE]     VARCHAR (255) NULL,
    [IS_DELETED]           BIT           NULL,
    [CREATE_DATE]          DATETIME      NULL,
    [CREATE_LOGIN_ID]      VARCHAR (255) NULL,
    [UPDATE_DATE]          DATETIME      NULL,
    [UPDATE_LOGIN_ID]      VARCHAR (255) NULL,
    CONSTRAINT [PK_T_USR_ALERT_URGENCY] PRIMARY KEY CLUSTERED ([USR_ALERT_URGENCY_ID] ASC)
);


GO
PRINT N'Creating [EA].[T_USR_ALERT_SEVERITY]...';


GO
CREATE TABLE [EA].[T_USR_ALERT_SEVERITY] (
    [USR_ALERT_SEVERITY_ID] INT           IDENTITY (1, 1) NOT NULL,
    [USR_ID]                INT           NULL,
    [SEVERITY_REF_CODE]     VARCHAR (255) NULL,
    [IS_DELETED]            BIT           NULL,
    [CREATE_DATE]           DATETIME      NULL,
    [CREATE_LOGIN_ID]       VARCHAR (255) NULL,
    [UPDATE_DATE]           DATETIME      NULL,
    [UPDATE_LOGIN_ID]       VARCHAR (255) NULL,
    CONSTRAINT [PK_T_USR_ALERT_SEVERITY] PRIMARY KEY CLUSTERED ([USR_ALERT_SEVERITY_ID] ASC)
);


GO
PRINT N'Creating [EA].[T_USR_ALERT_RECIPENT]...';


GO
CREATE TABLE [EA].[T_USR_ALERT_RECIPENT] (
    [USR_ALERT_RECIPENT_ID] INT            IDENTITY (1, 1) NOT NULL,
    [USR_ID]                INT            NULL,
    [RECIPIENT_NAME]        VARCHAR (255)  NULL,
    [RECIPIENT_EMAIL_ID]    VARCHAR (255)  NULL,
    [RECIPIENT_MOBILE]      NVARCHAR (255) NULL,
    [IS_DELETED]            BIT            NULL,
    [CREATE_DATE]           DATETIME       NULL,
    [CREATE_LOGIN_ID]       VARCHAR (255)  NULL,
    [UPDATE_DATE]           DATETIME       NULL,
    [UPDATE_LOGIN_ID]       VARCHAR (255)  NULL,
    [COUNTRY_CODE]          VARCHAR (255)  NULL,
    [IS_NOTIFY]             BIT            NULL,
    CONSTRAINT [PK_T_USR_ALERT_RECIPENT] PRIMARY KEY CLUSTERED ([USR_ALERT_RECIPENT_ID] ASC)
);


GO
PRINT N'Creating [EA].[T_USR_ALERT_CHANNEL]...';


GO
CREATE TABLE [EA].[T_USR_ALERT_CHANNEL] (
    [USR_ALERT_CHANNEL_ID] INT           IDENTITY (1, 1) NOT NULL,
    [USR_ID]               INT           NULL,
    [CHANNEL]              VARCHAR (255) NULL,
    [IS_DELETED]           BIT           NULL,
    [CREATE_DATE]          DATETIME      NULL,
    [CREATE_LOGIN_ID]      VARCHAR (255) NULL,
    [UPDATE_DATE]          DATETIME      NULL,
    [UPDATE_LOGIN_ID]      VARCHAR (255) NULL,
    CONSTRAINT [PK_T_USR_ALERT_CHANNEL] PRIMARY KEY CLUSTERED ([USR_ALERT_CHANNEL_ID] ASC)
);


GO
PRINT N'Creating [EA].[T_USR_ALERT_CERTAINTY]...';


GO
CREATE TABLE [EA].[T_USR_ALERT_CERTAINTY] (
    [USR_ALERT_CERTAINTY_ID] INT           IDENTITY (1, 1) NOT NULL,
    [USR_ID]                 INT           NULL,
    [CERTAINTY_REF_CODE]     VARCHAR (255) NULL,
    [IS_DELETED]             BIT           NULL,
    [CREATE_DATE]            DATETIME      NULL,
    [CREATE_LOGIN_ID]        VARCHAR (255) NULL,
    [UPDATE_DATE]            DATETIME      NULL,
    [UPDATE_LOGIN_ID]        VARCHAR (255) NULL,
    CONSTRAINT [PK_T_USR_ALERT_CERTAINTY] PRIMARY KEY CLUSTERED ([USR_ALERT_CERTAINTY_ID] ASC)
);


GO
PRINT N'Creating [EA].[T_USR_ALERT_CATEGORY]...';


GO
CREATE TABLE [EA].[T_USR_ALERT_CATEGORY] (
    [USR_ALERT_CATEGORY_ID] INT           IDENTITY (1, 1) NOT NULL,
    [USR_ID]                INT           NULL,
    [CATEGORY_REF_CODE]     VARCHAR (255) NULL,
    [IS_DELETED]            BIT           NULL,
    [CREATE_DATE]           DATETIME      NULL,
    [CREATE_LOGIN_ID]       VARCHAR (255) NULL,
    [UPDATE_DATE]           DATETIME      NULL,
    [UPDATE_LOGIN_ID]       VARCHAR (255) NULL,
    CONSTRAINT [PK_T_USR_ALERT_CATEGORY] PRIMARY KEY CLUSTERED ([USR_ALERT_CATEGORY_ID] ASC)
);


GO
PRINT N'Creating [EA].[L_USR_STATUS]...';


GO
CREATE TABLE [EA].[L_USR_STATUS] (
    [USR_STATUS_ID]   INT           IDENTITY (1, 1) NOT NULL,
    [USR_STATUS_NAME] VARCHAR (255) NULL,
    [IS_DELETED]      BIT           NULL,
    [CREATE_DATE]     DATETIME      NULL,
    [CREATE_LOGIN_ID] VARCHAR (255) NULL,
    [UPDATE_DATE]     DATETIME      NULL,
    [UPDATE_LOGIN_ID] VARCHAR (255) NULL,
    CONSTRAINT [PK_L_USR_STATUS] PRIMARY KEY CLUSTERED ([USR_STATUS_ID] ASC)
);


GO
PRINT N'Creating [EA].[L_USER_TYPE]...';


GO
CREATE TABLE [EA].[L_USER_TYPE] (
    [USER_TYPE_ID]    INT           IDENTITY (1, 1) NOT NULL,
    [USER_TYPE_NAME]  VARCHAR (255) NULL,
    [IS_DELETED]      BIT           NULL,
    [CREATE_DATE]     DATETIME      NULL,
    [CREATE_LOGIN_ID] VARCHAR (255) NULL,
    [UPDATE_DATE]     DATETIME      NULL,
    [UPDATE_LOGIN_ID] VARCHAR (255) NULL,
    CONSTRAINT [PK_L_USER_TYPE] PRIMARY KEY CLUSTERED ([USER_TYPE_ID] ASC)
);


GO
PRINT N'Creating [EA].[T_USR]...';


GO
CREATE TABLE [EA].[T_USR] (
    [USR_ID]                            INT            IDENTITY (1, 1) NOT NULL,
    [USR_CODE]                          VARCHAR (255)  NULL,
    [REQUESTING_OFFICE_ID]              INT            NULL,
    [CLIENT_ID]                         INT            NULL,
    [SERVICE_DESCRIPTION]               NVARCHAR (MAX) NULL,
    [USR_START_DATE]                    DATETIME       NULL,
    [USR_END_DATE]                      DATETIME       NULL,
    [OM_LOGIN_ID]                       VARCHAR (255)  NULL,
    [REVIEWER_ID]                       VARCHAR (255)  NULL,
    [REVIEWER_START_DATE]               DATETIME       NULL,
    [REVIEWER_END_DATE]                 DATETIME       NULL,
    [REVIEWER_COMMENT]                  VARCHAR (MAX)  NULL,
    [KEYWORDS]                          NVARCHAR (MAX) NULL,
    [USR_STATUS_ID]                     INT            NULL,
    [IS_DELETED]                        BIT            NULL,
    [CREATE_DATE]                       DATETIME       NULL,
    [CREATE_LOGIN_ID]                   VARCHAR (255)  NULL,
    [UPDATE_DATE]                       DATETIME       NULL,
    [UPDATE_LOGIN_ID]                   VARCHAR (255)  NULL,
    [REQUESTING_DIRECTOR_ID]            VARCHAR (255)  NULL,
    [SERVICE_TYPE_CATEGORY_ID]          INT            NULL,
    [ASSET_TYPE]                        INT            NULL,
    [ALERT_START_DATE]                  DATETIME       NULL,
    [ALERT_END_DATE]                    DATETIME       NULL,
    [OM_POC_EMAIL_ID]                   VARCHAR (255)  NULL,
    [OM_POC_NAME]                       VARCHAR (255)  NULL,
    [OM_POC_MOBILE]                     VARCHAR (255)  NULL,
    [OM_POC_NOTES]                      VARCHAR (MAX)  NULL,
    [IS_ONGOING]                        BIT            NULL,
    [OM_POC_COUNTRY_CODE]               VARCHAR (255)  NULL,
    [REQUESTING_REGION_ID]              INT            NULL,
    [REQUESTING_DIRECTOR_DEPARTMENT_ID] INT            NULL,
    CONSTRAINT [PK_T_USR] PRIMARY KEY CLUSTERED ([USR_ID] ASC)
);


GO
ALTER TABLE [EA].[T_USR] ENABLE CHANGE_TRACKING WITH (TRACK_COLUMNS_UPDATED = ON);


GO
PRINT N'Creating [EA].[FK_L_SUB_SERVICES_L_SERVICES]...';


GO
ALTER TABLE [EA].[L_SUB_SERVICES] WITH NOCHECK
    ADD CONSTRAINT [FK_L_SUB_SERVICES_L_SERVICES] FOREIGN KEY ([SERVICES_ID]) REFERENCES [EA].[L_SERVICES] ([SERVICES_ID]);


GO
PRINT N'Creating [EA].[FK_L_SERVICE_TYPE_CATEGORY_L_SERVICE_TYPE]...';


GO
ALTER TABLE [EA].[L_SERVICE_TYPE_CATEGORY] WITH NOCHECK
    ADD CONSTRAINT [FK_L_SERVICE_TYPE_CATEGORY_L_SERVICE_TYPE] FOREIGN KEY ([SERVICE_TYPE_ID]) REFERENCES [EA].[L_SERVICE_TYPE] ([SERVICE_TYPE_ID]);


GO
PRINT N'Creating [EA].[FK_L_REQUESTING_OFFICE_L_REQUESTING_REGION]...';


GO
ALTER TABLE [EA].[L_REQUESTING_OFFICE] WITH NOCHECK
    ADD CONSTRAINT [FK_L_REQUESTING_OFFICE_L_REQUESTING_REGION] FOREIGN KEY ([REGION_ID]) REFERENCES [EA].[L_REQUESTING_REGION] ([REQUESTING_REGION_ID]);


GO
PRINT N'Creating [EA].[FK_L_MASTER_VALUE_L_MASTER_TYPE]...';


GO
ALTER TABLE [EA].[L_MASTER_VALUE] WITH NOCHECK
    ADD CONSTRAINT [FK_L_MASTER_VALUE_L_MASTER_TYPE] FOREIGN KEY ([MASTER_TYPE_ID]) REFERENCES [EA].[L_MASTER_TYPE] ([MASTER_TYPE_ID]);


GO
PRINT N'Creating [EA].[FK_L_CLIENT_REQUESTING_OFFICE_L_CLIENT]...';


GO
ALTER TABLE [EA].[L_CLIENT_REQUESTING_OFFICE] WITH NOCHECK
    ADD CONSTRAINT [FK_L_CLIENT_REQUESTING_OFFICE_L_CLIENT] FOREIGN KEY ([CLIENT_ID]) REFERENCES [EA].[L_CLIENT] ([CLIENT_ID]);


GO
PRINT N'Creating [EA].[FK_L_CLIENT_REQUESTING_OFFICE_L_REQUESTING_OFFICE]...';


GO
ALTER TABLE [EA].[L_CLIENT_REQUESTING_OFFICE] WITH NOCHECK
    ADD CONSTRAINT [FK_L_CLIENT_REQUESTING_OFFICE_L_REQUESTING_OFFICE] FOREIGN KEY ([CLIENT_REQUESTING_OFFICE_ID]) REFERENCES [EA].[L_REQUESTING_OFFICE] ([REQUESTING_OFFICE_ID]);


GO
PRINT N'Creating [EA].[FK_T_USR_SERVICE_TYPE_T_USR]...';


GO
ALTER TABLE [EA].[T_USR_SERVICE_TYPE] WITH NOCHECK
    ADD CONSTRAINT [FK_T_USR_SERVICE_TYPE_T_USR] FOREIGN KEY ([USR_ID]) REFERENCES [EA].[T_USR] ([USR_ID]);


GO
PRINT N'Creating [EA].[FK_T_USR_RECIPIENTS_T_USR]...';


GO
ALTER TABLE [EA].[T_USR_RECIPIENTS] WITH NOCHECK
    ADD CONSTRAINT [FK_T_USR_RECIPIENTS_T_USR] FOREIGN KEY ([USR_ID]) REFERENCES [EA].[T_USR] ([USR_ID]);


GO
PRINT N'Creating [EA].[FK_T_USR_PURPOSE_T_USR]...';


GO
ALTER TABLE [EA].[T_USR_PURPOSE] WITH NOCHECK
    ADD CONSTRAINT [FK_T_USR_PURPOSE_T_USR] FOREIGN KEY ([USR_ID]) REFERENCES [EA].[T_USR] ([USR_ID]);


GO
PRINT N'Creating [EA].[FK_T_USR_LOCATION_L_COUNTRY]...';


GO
ALTER TABLE [EA].[T_USR_LOCATION] WITH NOCHECK
    ADD CONSTRAINT [FK_T_USR_LOCATION_L_COUNTRY] FOREIGN KEY ([COUNTRY_ID]) REFERENCES [EA].[L_COUNTRY] ([COUNTRY_ID]);


GO
PRINT N'Creating [EA].[FK_T_USR_LOCATION_T_USR]...';


GO
ALTER TABLE [EA].[T_USR_LOCATION] WITH NOCHECK
    ADD CONSTRAINT [FK_T_USR_LOCATION_T_USR] FOREIGN KEY ([USR_ID]) REFERENCES [EA].[T_USR] ([USR_ID]);


GO
PRINT N'Creating [EA].[FK_T_USR_AUTHOR_T_USR]...';


GO
ALTER TABLE [EA].[T_USR_AUTHOR] WITH NOCHECK
    ADD CONSTRAINT [FK_T_USR_AUTHOR_T_USR] FOREIGN KEY ([USR_ID]) REFERENCES [EA].[T_USR] ([USR_ID]);


GO
PRINT N'Creating [EA].[FK_T_USR_ATTACHMENTS_T_USR]...';


GO
ALTER TABLE [EA].[T_USR_ATTACHMENTS] WITH NOCHECK
    ADD CONSTRAINT [FK_T_USR_ATTACHMENTS_T_USR] FOREIGN KEY ([USR_ID]) REFERENCES [EA].[T_USR] ([USR_ID]);


GO
PRINT N'Creating [EA].[FK_T_USR_ASSET_SOS_DETAILS]...';


GO
ALTER TABLE [EA].[T_USR_ASSET_SOS_DETAILS] WITH NOCHECK
    ADD CONSTRAINT [FK_T_USR_ASSET_SOS_DETAILS] FOREIGN KEY ([USR_ASSET_ID]) REFERENCES [EA].[T_USR_ASSET] ([USR_ASSET_ID]);


GO
PRINT N'Creating [EA].[FK_T_USR_ASSET_NOTIFICATION]...';


GO
ALTER TABLE [EA].[T_USR_ASSET_NOTIFICATION] WITH NOCHECK
    ADD CONSTRAINT [FK_T_USR_ASSET_NOTIFICATION] FOREIGN KEY ([USR_ASSET_ID]) REFERENCES [EA].[T_USR_ASSET] ([USR_ASSET_ID]);


GO
PRINT N'Creating [EA].[FK_T_USR_ASSET_L_GROUP]...';


GO
ALTER TABLE [EA].[T_USR_ASSET] WITH NOCHECK
    ADD CONSTRAINT [FK_T_USR_ASSET_L_GROUP] FOREIGN KEY ([GROUP_ID]) REFERENCES [EA].[L_GROUP] ([GROUP_ID]);


GO
PRINT N'Creating [EA].[FK_T_USR_ASSET_T_USER_TYPE]...';


GO
ALTER TABLE [EA].[T_USR_ASSET] WITH NOCHECK
    ADD CONSTRAINT [FK_T_USR_ASSET_T_USER_TYPE] FOREIGN KEY ([USER_TYPE_ID]) REFERENCES [EA].[L_USER_TYPE] ([USER_TYPE_ID]);


GO
PRINT N'Creating [EA].[FK_T_USR_ASSET_T_USR]...';


GO
ALTER TABLE [EA].[T_USR_ASSET] WITH NOCHECK
    ADD CONSTRAINT [FK_T_USR_ASSET_T_USR] FOREIGN KEY ([USR_ID]) REFERENCES [EA].[T_USR] ([USR_ID]);


GO
PRINT N'Creating [EA].[FK_T_USR_ALERT_WARNE_TYPE_T_USR]...';


GO
ALTER TABLE [EA].[T_USR_ALERT_WARNE_TYPE] WITH NOCHECK
    ADD CONSTRAINT [FK_T_USR_ALERT_WARNE_TYPE_T_USR] FOREIGN KEY ([USR_ID]) REFERENCES [EA].[T_USR] ([USR_ID]);


GO
PRINT N'Creating [EA].[FK_T_USR_ALERT_URGENCY_T_USR]...';


GO
ALTER TABLE [EA].[T_USR_ALERT_URGENCY] WITH NOCHECK
    ADD CONSTRAINT [FK_T_USR_ALERT_URGENCY_T_USR] FOREIGN KEY ([USR_ID]) REFERENCES [EA].[T_USR] ([USR_ID]);


GO
PRINT N'Creating [EA].[FK_T_USR_ALERT_SEVERITY_T_USR]...';


GO
ALTER TABLE [EA].[T_USR_ALERT_SEVERITY] WITH NOCHECK
    ADD CONSTRAINT [FK_T_USR_ALERT_SEVERITY_T_USR] FOREIGN KEY ([USR_ID]) REFERENCES [EA].[T_USR] ([USR_ID]);


GO
PRINT N'Creating [EA].[FK_T_USR_ALERT_RECIPENT_T_USR]...';


GO
ALTER TABLE [EA].[T_USR_ALERT_RECIPENT] WITH NOCHECK
    ADD CONSTRAINT [FK_T_USR_ALERT_RECIPENT_T_USR] FOREIGN KEY ([USR_ID]) REFERENCES [EA].[T_USR] ([USR_ID]);


GO
PRINT N'Creating [EA].[FK_T_USR_ALERT_CHANNEL_T_USR]...';


GO
ALTER TABLE [EA].[T_USR_ALERT_CHANNEL] WITH NOCHECK
    ADD CONSTRAINT [FK_T_USR_ALERT_CHANNEL_T_USR] FOREIGN KEY ([USR_ID]) REFERENCES [EA].[T_USR] ([USR_ID]);


GO
PRINT N'Creating [EA].[FK_T_USR_ALERT_CERTAINTY_T_USR]...';


GO
ALTER TABLE [EA].[T_USR_ALERT_CERTAINTY] WITH NOCHECK
    ADD CONSTRAINT [FK_T_USR_ALERT_CERTAINTY_T_USR] FOREIGN KEY ([USR_ID]) REFERENCES [EA].[T_USR] ([USR_ID]);


GO
PRINT N'Creating [EA].[FK_T_USR_ALERT_CATEGORY_T_USR]...';


GO
ALTER TABLE [EA].[T_USR_ALERT_CATEGORY] WITH NOCHECK
    ADD CONSTRAINT [FK_T_USR_ALERT_CATEGORY_T_USR] FOREIGN KEY ([USR_ID]) REFERENCES [EA].[T_USR] ([USR_ID]);


GO
PRINT N'Creating [EA].[FK_T_USR_L_CLIENT]...';


GO
ALTER TABLE [EA].[T_USR] WITH NOCHECK
    ADD CONSTRAINT [FK_T_USR_L_CLIENT] FOREIGN KEY ([CLIENT_ID]) REFERENCES [EA].[L_CLIENT] ([CLIENT_ID]);


GO
PRINT N'Creating [EA].[FK_T_USR_REQUESTING_DIRECTOR_DEPARTMENT]...';


GO
ALTER TABLE [EA].[T_USR] WITH NOCHECK
    ADD CONSTRAINT [FK_T_USR_REQUESTING_DIRECTOR_DEPARTMENT] FOREIGN KEY ([REQUESTING_DIRECTOR_DEPARTMENT_ID]) REFERENCES [EA].[L_REQUESTING_DIRECTOR_DEPARTMENT] ([REQUESTING_DIRECTOR_DEPARTMENT_ID]);


GO
PRINT N'Creating [EA].[FK_T_USR_REQUESTING_REGION]...';


GO
ALTER TABLE [EA].[T_USR] WITH NOCHECK
    ADD CONSTRAINT [FK_T_USR_REQUESTING_REGION] FOREIGN KEY ([REQUESTING_REGION_ID]) REFERENCES [EA].[L_REQUESTING_REGION] ([REQUESTING_REGION_ID]);


GO
PRINT N'Creating [dbo].[fn_diagramobjects]...';


GO

	CREATE FUNCTION [dbo].[fn_diagramobjects]() 
	RETURNS int
	WITH EXECUTE AS N'dbo'
	AS
	BEGIN
		declare @id_upgraddiagrams		int
		declare @id_sysdiagrams			int
		declare @id_helpdiagrams		int
		declare @id_helpdiagramdefinition	int
		declare @id_creatediagram	int
		declare @id_renamediagram	int
		declare @id_alterdiagram 	int 
		declare @id_dropdiagram		int
		declare @InstalledObjects	int

		select @InstalledObjects = 0

		select 	@id_upgraddiagrams = object_id(N'dbo.sp_upgraddiagrams'),
			@id_sysdiagrams = object_id(N'dbo.sysdiagrams'),
			@id_helpdiagrams = object_id(N'dbo.sp_helpdiagrams'),
			@id_helpdiagramdefinition = object_id(N'dbo.sp_helpdiagramdefinition'),
			@id_creatediagram = object_id(N'dbo.sp_creatediagram'),
			@id_renamediagram = object_id(N'dbo.sp_renamediagram'),
			@id_alterdiagram = object_id(N'dbo.sp_alterdiagram'), 
			@id_dropdiagram = object_id(N'dbo.sp_dropdiagram')

		if @id_upgraddiagrams is not null
			select @InstalledObjects = @InstalledObjects + 1
		if @id_sysdiagrams is not null
			select @InstalledObjects = @InstalledObjects + 2
		if @id_helpdiagrams is not null
			select @InstalledObjects = @InstalledObjects + 4
		if @id_helpdiagramdefinition is not null
			select @InstalledObjects = @InstalledObjects + 8
		if @id_creatediagram is not null
			select @InstalledObjects = @InstalledObjects + 16
		if @id_renamediagram is not null
			select @InstalledObjects = @InstalledObjects + 32
		if @id_alterdiagram  is not null
			select @InstalledObjects = @InstalledObjects + 64
		if @id_dropdiagram is not null
			select @InstalledObjects = @InstalledObjects + 128
		
		return @InstalledObjects 
	END
GO
PRINT N'Creating [dbo].[spGetChangeTracking]...';


GO
-- Batch submitted through debugger: spGetChangeTracking.sql|8|0|C:\Users\mkomaravolu\Desktop\Local-Pinkerton-DB\Source\SourceCode\Database\Test_local\pinkerton\USR_C\USR_C\Programmable Objects\dbo\Stored Procedures\spGetChangeTracking.sql

CREATE PROCEDURE [dbo].[spGetChangeTracking]
	AS
BEGIN
DECLARE @LAST_SYNC_VERSION  bigint;
DECLARE @CURRENT_SYNC_VERSION bigint;
SET @LAST_SYNC_VERSION =0
SET @CURRENT_SYNC_VERSION=CHANGE_TRACKING_CURRENT_VERSION()

SELECT @CURRENT_SYNC_VERSION

SELECT CHANGE_TRACKING_CURRENT_VERSION() AS CURRENT_SYNC_VERSION,
CHANGE_TRACKING_MIN_VALID_VERSION (OBJECT_ID('EA.T_USR')) AS MIN_VALID_VERSION

SELECT CT.SYS_CHANGE_OPERATION,
CT.SYS_CHANGE_VERSION,CT.SYS_CHANGE_COLUMNS,CT.SYS_CHANGE_CREATION_VERSION,CT.SYS_CHANGE_CONTEXT
 FROM CHANGETABLE(CHANGES EA.T_USR,@LAST_SYNC_VERSION)
  AS CT ORDER BY SYS_CHANGE_VERSION DESC

select 
CT.SYS_CHANGE_OPERATION,CT.SYS_CHANGE_VERSION,CT.USR_ID,TU.*,
CT.SYS_CHANGE_COLUMNS,CT.SYS_CHANGE_CONTEXT,CT.SYS_CHANGE_CREATION_VERSION,
convert(varchar,CT.SYS_CHANGE_CONTEXT) as CHANGE_CONTEXT,
CHANGE_TRACKING_IS_COLUMN_IN_MASK(COLUMNPROPERTY(OBJECT_ID('USR_DEV.EA.T_USR'),
'USR_ID', 'ColumnId'), SYS_CHANGE_COLUMNS) AS CHANGE_USR_ID,
CHANGE_TRACKING_IS_COLUMN_IN_MASK(COLUMNPROPERTY(OBJECT_ID('USR_DEV.EA.T_USR'),
'USR_CODE', 'ColumnId'), SYS_CHANGE_COLUMNS) AS CHANGE_USR_CODE,
 CHANGE_TRACKING_IS_COLUMN_IN_MASK(COLUMNPROPERTY(OBJECT_ID('USR_DEV.EA.T_USR'),
'REQUESTING_OFFICE_ID', 'ColumnId'), SYS_CHANGE_COLUMNS) AS CHANGE_REQUESTING_OFFICE_ID,
CHANGE_TRACKING_IS_COLUMN_IN_MASK(COLUMNPROPERTY(OBJECT_ID('USR_DEV.EA.T_USR'),
'CLIENT_ID', 'ColumnId'), SYS_CHANGE_COLUMNS) AS CHANGE_CLIENT_ID,
CHANGE_TRACKING_IS_COLUMN_IN_MASK(COLUMNPROPERTY(OBJECT_ID('USR_DEV.EA.T_USR'),
'SERVICE_DESCRIPTION', 'ColumnId'), SYS_CHANGE_COLUMNS) AS CHANGE_SERVICE_DESCRIPTION,
CHANGE_TRACKING_IS_COLUMN_IN_MASK(COLUMNPROPERTY(OBJECT_ID('USR_DEV.EA.T_USR'),
'USR_START_DATE', 'ColumnId'), SYS_CHANGE_COLUMNS) AS CHANGE_USR_START_DATE,
CHANGE_TRACKING_IS_COLUMN_IN_MASK(COLUMNPROPERTY(OBJECT_ID('USR_DEV.EA.T_USR'),
'USR_END_DATE', 'ColumnId'), SYS_CHANGE_COLUMNS) AS CHANGE_USR_END_DATE,
CHANGE_TRACKING_IS_COLUMN_IN_MASK(COLUMNPROPERTY(OBJECT_ID('USR_DEV.EA.T_USR'),
'OM_LOGIN_ID', 'ColumnId'), SYS_CHANGE_COLUMNS) AS CHANGE_OM_LOGIN_ID,
CHANGE_TRACKING_IS_COLUMN_IN_MASK(COLUMNPROPERTY(OBJECT_ID('USR_DEV.EA.T_USR'),
'REVIEWER_ID', 'ColumnId'), SYS_CHANGE_COLUMNS) AS CHANGE_REVIEWER_ID,
CHANGE_TRACKING_IS_COLUMN_IN_MASK(COLUMNPROPERTY(OBJECT_ID('USR_DEV.EA.T_USR'),
'REVIEWER_START_DATE', 'ColumnId'), SYS_CHANGE_COLUMNS) AS CHANGE_REVIEWER_START_DATE,
CHANGE_TRACKING_IS_COLUMN_IN_MASK(COLUMNPROPERTY(OBJECT_ID('USR_DEV.EA.T_USR'),
'REVIEWER_END_DATE', 'ColumnId'), SYS_CHANGE_COLUMNS) AS CHANGE_REVIEWER_END_DATE,
CHANGE_TRACKING_IS_COLUMN_IN_MASK(COLUMNPROPERTY(OBJECT_ID('USR_DEV.EA.T_USR'),
'REVIEWER_COMMENTS', 'ColumnId'), SYS_CHANGE_COLUMNS) AS CHANGE_REVIEWER_COMMENTS,
CHANGE_TRACKING_IS_COLUMN_IN_MASK(COLUMNPROPERTY(OBJECT_ID('USR_DEV.EA.T_USR'),
'KEYWORDS', 'ColumnId'), SYS_CHANGE_COLUMNS) AS CHANGE_KEYWORDS,
CHANGE_TRACKING_IS_COLUMN_IN_MASK(COLUMNPROPERTY(OBJECT_ID('USR_DEV.EA.T_USR'),
'USR_STATUS_ID', 'ColumnId'), SYS_CHANGE_COLUMNS) AS CHANGE_USR_STATUS_ID,
CHANGE_TRACKING_IS_COLUMN_IN_MASK(COLUMNPROPERTY(OBJECT_ID('USR_DEV.EA.T_USR'),
'IS_DELETED', 'ColumnId'), SYS_CHANGE_COLUMNS) AS IS_DELETED,
CHANGE_TRACKING_IS_COLUMN_IN_MASK(COLUMNPROPERTY(OBJECT_ID('USR_DEV.EA.T_USR'),
'CREATE_DATE', 'ColumnId'), SYS_CHANGE_COLUMNS) AS CREATE_DATE,
CHANGE_TRACKING_IS_COLUMN_IN_MASK(COLUMNPROPERTY(OBJECT_ID('USR_DEV.EA.T_USR'),
'UPDATE_LOGIN_ID', 'ColumnId'), SYS_CHANGE_COLUMNS) AS UPDATE_LOGIN_ID,
CHANGE_TRACKING_IS_COLUMN_IN_MASK(COLUMNPROPERTY(OBJECT_ID('USR_DEV.EA.T_USR'),
'UPDATE_DATE', 'ColumnId'), SYS_CHANGE_COLUMNS) AS UPDATE_DATE,
CHANGE_TRACKING_IS_COLUMN_IN_MASK(COLUMNPROPERTY(OBJECT_ID('USR_DEV.EA.T_USR'),
'CREATE_LOGIN_ID', 'ColumnId'), SYS_CHANGE_COLUMNS) AS CREATE_LOGIN_ID,
CHANGE_TRACKING_IS_COLUMN_IN_MASK(COLUMNPROPERTY(OBJECT_ID('USR_DEV.EA.T_USR'),
'REQUESTING_DIRECTOR_ID', 'ColumnId'), SYS_CHANGE_COLUMNS) AS CREATE_LOGIN_ID,
CHANGE_TRACKING_IS_COLUMN_IN_MASK(COLUMNPROPERTY(OBJECT_ID('USR_DEV.EA.T_USR'),
'SERVICE_TYPE_CATEGORY_ID', 'ColumnId'), SYS_CHANGE_COLUMNS) AS SERVICE_TYPE_CATEGORY_ID,
CHANGE_TRACKING_IS_COLUMN_IN_MASK(COLUMNPROPERTY(OBJECT_ID('USR_DEV.EA.T_USR'),
'ASSET_TYPE', 'ColumnId'), SYS_CHANGE_COLUMNS) AS ASSET_TYPE,
CHANGE_TRACKING_IS_COLUMN_IN_MASK(COLUMNPROPERTY(OBJECT_ID('USR_DEV.EA.T_USR'),
'ALERT_START_DATE', 'ColumnId'), SYS_CHANGE_COLUMNS) AS ALERT_START_DATE,
CHANGE_TRACKING_IS_COLUMN_IN_MASK(COLUMNPROPERTY(OBJECT_ID('USR_DEV.EA.T_USR'),
'ALERT_END_DATE', 'ColumnId'), SYS_CHANGE_COLUMNS) AS ALERT_END_DATE,
CHANGE_TRACKING_IS_COLUMN_IN_MASK(COLUMNPROPERTY(OBJECT_ID('USR_DEV.EA.T_USR'),
'REQUESTING_REGION_ID', 'ColumnId'), SYS_CHANGE_COLUMNS) AS REQUESTING_REGION_ID,
CHANGE_TRACKING_IS_COLUMN_IN_MASK(COLUMNPROPERTY(OBJECT_ID('USR_DEV.EA.T_USR'),
'OM_POC_EMAIL_ID', 'ColumnId'), SYS_CHANGE_COLUMNS) AS OM_POC_EMAIL_ID,
CHANGE_TRACKING_IS_COLUMN_IN_MASK(COLUMNPROPERTY(OBJECT_ID('USR_DEV.EA.T_USR'),
'OM_POC_MOBILE', 'ColumnId'), SYS_CHANGE_COLUMNS) AS OM_POC_MOBILE,
CHANGE_TRACKING_IS_COLUMN_IN_MASK(COLUMNPROPERTY(OBJECT_ID('USR_DEV.EA.T_USR'),
'OM_POC_NOTES', 'ColumnId'), SYS_CHANGE_COLUMNS) AS OM_POC_NOTES,
CHANGE_TRACKING_IS_COLUMN_IN_MASK(COLUMNPROPERTY(OBJECT_ID('USR_DEV.EA.T_USR'),
'IS_ONGOING', 'ColumnId'), SYS_CHANGE_COLUMNS) AS IS_ONGOING,
CHANGE_TRACKING_IS_COLUMN_IN_MASK(COLUMNPROPERTY(OBJECT_ID('USR_DEV.EA.T_USR'),
'OM_POC_NAME', 'ColumnId'), SYS_CHANGE_COLUMNS) AS OM_POC_NAME,
CHANGE_TRACKING_IS_COLUMN_IN_MASK(COLUMNPROPERTY(OBJECT_ID('USR_DEV.EA.T_USR'),
'REQUESTING_DIRECTOR_DEPARTMENT_ID', 'ColumnId'), SYS_CHANGE_COLUMNS) AS REQUESTING_DIRECTOR_DEPARTMENT_ID
from CHANGETABLE (CHANGES EA.T_USR,@LAST_SYNC_VERSION) ct
left outer join EA.T_USR TU on TU.USR_ID= CT.USR_ID
ORDER BY SYS_CHANGE_VERSION DESC

BEGIN TRAN
    DECLARE @CONTEXT VARBINARY(100)
	SET @CONTEXT = CONVERT( VARBINARY,'ServerChange-' + CONVERT(VARCHAR,GETUTCDATE(),112));	
	WITH CHANGE_TRACKING_CONTEXT( @CONTEXT)
	UPDATE EA.T_USR SET UPDATE_LOGIN_ID=UPDATE_LOGIN_ID;
COMMIT TRAN 
END
GO
PRINT N'Checking existing data against newly created constraints';


GO
USE [$(DatabaseName)];


GO
ALTER TABLE [EA].[L_SUB_SERVICES] WITH CHECK CHECK CONSTRAINT [FK_L_SUB_SERVICES_L_SERVICES];

ALTER TABLE [EA].[L_SERVICE_TYPE_CATEGORY] WITH CHECK CHECK CONSTRAINT [FK_L_SERVICE_TYPE_CATEGORY_L_SERVICE_TYPE];

ALTER TABLE [EA].[L_REQUESTING_OFFICE] WITH CHECK CHECK CONSTRAINT [FK_L_REQUESTING_OFFICE_L_REQUESTING_REGION];

ALTER TABLE [EA].[L_MASTER_VALUE] WITH CHECK CHECK CONSTRAINT [FK_L_MASTER_VALUE_L_MASTER_TYPE];

ALTER TABLE [EA].[L_CLIENT_REQUESTING_OFFICE] WITH CHECK CHECK CONSTRAINT [FK_L_CLIENT_REQUESTING_OFFICE_L_CLIENT];

ALTER TABLE [EA].[L_CLIENT_REQUESTING_OFFICE] WITH CHECK CHECK CONSTRAINT [FK_L_CLIENT_REQUESTING_OFFICE_L_REQUESTING_OFFICE];

ALTER TABLE [EA].[T_USR_SERVICE_TYPE] WITH CHECK CHECK CONSTRAINT [FK_T_USR_SERVICE_TYPE_T_USR];

ALTER TABLE [EA].[T_USR_RECIPIENTS] WITH CHECK CHECK CONSTRAINT [FK_T_USR_RECIPIENTS_T_USR];

ALTER TABLE [EA].[T_USR_PURPOSE] WITH CHECK CHECK CONSTRAINT [FK_T_USR_PURPOSE_T_USR];

ALTER TABLE [EA].[T_USR_LOCATION] WITH CHECK CHECK CONSTRAINT [FK_T_USR_LOCATION_L_COUNTRY];

ALTER TABLE [EA].[T_USR_LOCATION] WITH CHECK CHECK CONSTRAINT [FK_T_USR_LOCATION_T_USR];

ALTER TABLE [EA].[T_USR_AUTHOR] WITH CHECK CHECK CONSTRAINT [FK_T_USR_AUTHOR_T_USR];

ALTER TABLE [EA].[T_USR_ATTACHMENTS] WITH CHECK CHECK CONSTRAINT [FK_T_USR_ATTACHMENTS_T_USR];

ALTER TABLE [EA].[T_USR_ASSET_SOS_DETAILS] WITH CHECK CHECK CONSTRAINT [FK_T_USR_ASSET_SOS_DETAILS];

ALTER TABLE [EA].[T_USR_ASSET_NOTIFICATION] WITH CHECK CHECK CONSTRAINT [FK_T_USR_ASSET_NOTIFICATION];

ALTER TABLE [EA].[T_USR_ASSET] WITH CHECK CHECK CONSTRAINT [FK_T_USR_ASSET_L_GROUP];

ALTER TABLE [EA].[T_USR_ASSET] WITH CHECK CHECK CONSTRAINT [FK_T_USR_ASSET_T_USER_TYPE];

ALTER TABLE [EA].[T_USR_ASSET] WITH CHECK CHECK CONSTRAINT [FK_T_USR_ASSET_T_USR];

ALTER TABLE [EA].[T_USR_ALERT_WARNE_TYPE] WITH CHECK CHECK CONSTRAINT [FK_T_USR_ALERT_WARNE_TYPE_T_USR];

ALTER TABLE [EA].[T_USR_ALERT_URGENCY] WITH CHECK CHECK CONSTRAINT [FK_T_USR_ALERT_URGENCY_T_USR];

ALTER TABLE [EA].[T_USR_ALERT_SEVERITY] WITH CHECK CHECK CONSTRAINT [FK_T_USR_ALERT_SEVERITY_T_USR];

ALTER TABLE [EA].[T_USR_ALERT_RECIPENT] WITH CHECK CHECK CONSTRAINT [FK_T_USR_ALERT_RECIPENT_T_USR];

ALTER TABLE [EA].[T_USR_ALERT_CHANNEL] WITH CHECK CHECK CONSTRAINT [FK_T_USR_ALERT_CHANNEL_T_USR];

ALTER TABLE [EA].[T_USR_ALERT_CERTAINTY] WITH CHECK CHECK CONSTRAINT [FK_T_USR_ALERT_CERTAINTY_T_USR];

ALTER TABLE [EA].[T_USR_ALERT_CATEGORY] WITH CHECK CHECK CONSTRAINT [FK_T_USR_ALERT_CATEGORY_T_USR];

ALTER TABLE [EA].[T_USR] WITH CHECK CHECK CONSTRAINT [FK_T_USR_L_CLIENT];

ALTER TABLE [EA].[T_USR] WITH CHECK CHECK CONSTRAINT [FK_T_USR_REQUESTING_DIRECTOR_DEPARTMENT];

ALTER TABLE [EA].[T_USR] WITH CHECK CHECK CONSTRAINT [FK_T_USR_REQUESTING_REGION];


GO
PRINT N'Update complete.';


GO
